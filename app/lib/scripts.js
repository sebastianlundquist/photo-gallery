"use strict";(function(){function updatePhotoInfo(photoArray){for(var i=0;i<photoCount;i++)photoInfo.URLs.push("https://farm"+photoArray.photos.photo[i].farm+".staticflickr.com/"+photoArray.photos.photo[i].server+"/"+photoArray.photos.photo[i].id+"_"+photoArray.photos.photo[i].secret+"_n.jpg"),photoInfo.userIDs.push(photoArray.photos.photo[i].id),photoInfo.titles.push(photoArray.photos.photo[i].title);return photoArray}function generatePhotoContainers(photoArray){for(var photoGroup=document.getElementById("photo-group"),photoTitle="",photographer="",i=0;i<photoCount;i++)photoTitle=""===photoInfo.titles[i]?"No title":photoInfo.titles[i],photographer=photoArray.photos.photo[i].owner,photoGroup.innerHTML+="<div id='div"+i+"' class='responsive' tabindex='0' style='background-image: url("+photoInfo.URLs[i]+")'>\n    <span class='grid-title'>"+photoTitle+"</span>\n    <a class='photographer' href='https://www.flickr.com/people/"+photographer+"'>&copy; user "+photographer+"</a>\n</div>"}function addEventListeners(){for(var _loop=function(i){document.getElementById("div"+i).addEventListener("click",function(){currentPhotoIndex=i,openFullscreen(i)}),document.getElementById("div"+i).addEventListener("keyup",function(e){"Enter"===e.key&&(currentPhotoIndex=i,openFullscreen(i))}),document.getElementsByClassName("photographer")[i].addEventListener("click",function(e){e.stopPropagation()}),document.getElementsByClassName("photographer")[i].addEventListener("keyup",function(e){e.stopPropagation()})},i=0;i<photoCount;i++)_loop(i);document.getElementById("photo-group").addEventListener("keyup",function(e){"ArrowLeft"===e.key&&0<currentPhotoIndex&&(currentPhotoIndex--,document.getElementById("div"+currentPhotoIndex).focus()),"ArrowRight"===e.key&&currentPhotoIndex<photoCount-1&&(currentPhotoIndex++,document.getElementById("div"+currentPhotoIndex).focus())}),document.getElementById("fullscreen-container").addEventListener("keyup",function(e){"ArrowLeft"===e.key&&nextPhoto(-1),"ArrowRight"===e.key&&nextPhoto(1),"Escape"===e.key&&closeFullscreen(currentPhotoIndex)}),document.getElementById("close").addEventListener("click",function(){closeFullscreen(currentPhotoIndex)}),document.getElementById("close").addEventListener("keyup",function(e){"Enter"===e.key&&closeFullscreen(currentPhotoIndex)}),document.getElementById("next").addEventListener("click",function(){nextPhoto(1)}),document.getElementById("next").addEventListener("keyup",function(e){"Enter"===e.key&&nextPhoto(1)}),document.getElementById("previous").addEventListener("click",function(){nextPhoto(-1)}),document.getElementById("previous").addEventListener("keyup",function(e){"Enter"===e.key&&nextPhoto(-1)})}function modifyURL(URL,size){return URL.replace("_n.","_"+size+".")}function openFullscreen(index){var displayImage=document.getElementById("display-image"),title=document.getElementById("fullscreen-title");displayImage.setAttribute("src",modifyURL(photoInfo.URLs[index],"h")),""===photoInfo.titles[index]?(displayImage.setAttribute("alt",""),title.innerText="No title"):(displayImage.setAttribute("alt",photoInfo.titles[index]),title.innerText=photoInfo.titles[index]),document.getElementById("fullscreen-container").style.display="block",document.getElementById("close").focus(),document.getElementById("photo-group").style.display="none"}function closeFullscreen(index){document.getElementById("fullscreen-container").style.display="none",document.getElementById("photo-group").style.display="block",document.getElementById("div"+index).focus()}function nextPhoto(step){var displayImage=document.getElementById("display-image"),title=document.getElementById("fullscreen-title");1===step&&currentPhotoIndex<photoInfo.URLs.length-1?currentPhotoIndex++:-1==step&&0<currentPhotoIndex&&currentPhotoIndex--,displayImage.setAttribute("src",modifyURL(photoInfo.URLs[currentPhotoIndex],"h")),""===photoInfo.titles[currentPhotoIndex]?(displayImage.setAttribute("alt",""),title.innerText="No title"):(displayImage.setAttribute("alt",photoInfo.titles[currentPhotoIndex]),title.innerText=photoInfo.titles[currentPhotoIndex])}function errorHandler(err){document.body.classList.remove("\uD83D\uDC39"),insertPoint.innerHTML+="<div id='error-container'>\n    <h1 id='error-header'>"+err[0]+"</h1>\n    <p id='error-message'>"+err[1]+"</p>\n</div>"}var currentPhotoIndex=0,photoCount=0,insertPoint=document.getElementById("gallery"),photoInfo={userIDs:[],URLs:[],titles:[]};(function(text,page,count,lat,lon){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.addEventListener("load",function(e){200===e.target.status?resolve(JSON.parse(e.target.response)):reject([404,"Server did not respond."])}),xhr.open("GET","https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=91311f10dd01517346db22e505210863&text="+text+"&lat="+lat+"&lon="+lon+"&radius=32&format=json&per_page="+count+"&nojsoncallback=1&page="+page),xhr.send()})})(insertPoint.getAttribute("data-text"),insertPoint.getAttribute("data-page"),insertPoint.getAttribute("data-count"),insertPoint.getAttribute("data-lat"),insertPoint.getAttribute("data-lon")).then(function(result){return"fail"===result.stat?void errorHandler([result.code,result.message]):(photoCount=result.photos.photo.length,result)},errorHandler).then(updatePhotoInfo).then(generatePhotoContainers).then(addEventListeners)})();